# ************************************
# Vhost template in module puppetlabs-apache
# Managed by Puppet
# ************************************

<VirtualHost *:${HTTP_PORT}>
  # ServerName mf-chsdi3

  ## Vhost docroot
  DocumentRoot "${VHOST_DIR}/htdocs"

  ## Directories, there should at least be a declaration for ${VHOST_DIR}/htdocs

  <Directory "${VHOST_DIR}/htdocs">
    Options +Indexes +FollowSymLinks +MultiViews
    AllowOverride None
    Require all granted
  </Directory>

  <Directory "${VHOST_DIR}/cgi-bin">
    Options +ExecCGI
    AllowOverride None
    Require all granted
    <FilesMatch ".+(\.cgi)$">
        SetHandler cgi-script
    </FilesMatch>
  </Directory>

  ## Load additional static includes
  Include "${VHOST_DIR}/conf/*.conf"

  ## Logging
  ErrorLogFormat "[%{cu}t] level=%l request_id=%L pid_tid=%P/%T - %M"
  ErrorLogFormat request "[%{cu}t] level=%l request_id=%L headers: User-Agent=\"%{User-Agent}i\" Referer=\"%{Referer}i\" Origin=\"%{Origin}i\" Accept-Language=\"%{Accept-Language}i\" Accept-Encoding=\"%{Accept-Encoding}i\"  Accept=\"%{Accept}i\""
  ErrorLog /dev/stdout
  CustomLog /dev/stdout "[%{%Y-%m-%dT%T}t.%{usec_frac}t] level=info request_id=%L \"%r\" status=%>s remote=%h duration=%{ms}T query=%q content-encoding=\"%{Content-Encoding}o\" content-type=\"%{Content-Type}o\" content-length=\"%{Content-Length}o\"
  LogLevel ${APACHE_LOG_LEVEL}
  ServerSignature Off


  ## Script alias directives
  ScriptAlias /cgi-bin "${VHOST_DIR}/cgi-bin/"

  ## Server aliases
  # ServerAlias api.geo.admin.ch
  # ServerAlias api3.geo.admin.ch
  # ServerAlias mf-chsdi3.ci.bgdi.ch
  # ServerAlias mf-chsdi3.demo.bgdi.ch
  # ServerAlias mf-chsdi3.dev.bgdi.ch
  # ServerAlias mf-chsdi3.infra.bgdi.ch
  # ServerAlias mf-chsdi3.int.bgdi.ch
  # ServerAlias mf-chsdi3.prod.bgdi.ch
  # ServerAlias s.geo.admin.ch
  SetEnvIf X-Forwarded-For "^.*\..*\..*\..*" forwarded
</VirtualHost>
