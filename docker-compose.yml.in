version: '2'
services:
  chsdi3:
    build: .
    image: ${DOCKER_IMG_TAG_LATEST}
    env_file:
    - ${DEPLOY_TARGET}.env
    environment:
      PGUSER: ${PGUSER}
      PGPASSWORD: ${PGPASSWORD}
      OPENTRANS_API_KEY: ${OPENTRANS_API_KEY}
    command:
      - /usr/sbin/apache2ctl
      - "-D"
      - "FOREGROUND"
    ports:
      - "${APACHE_PORT}:${APACHE_PORT}"
    labels:
      io.rancher.scheduler.affinity:host_label: application=print,staging=${RANCHER_LABEL}
      io.rancher.container.pull_image: always
      io.rancher.scheduler.global: 'true'
